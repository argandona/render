{% extends 'base.html' %}
{% load static %}
<!-- NO cargues custom_filters -->
<!-- {% load custom_filters %} -->

{% block title %}Reporte de Productividad por Ejecutor{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 py-8">
    <!-- Encabezado -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-800 flex items-center">
            <i class="fas fa-chart-line text-blue-600 mr-3"></i>
            Reporte de Productividad por Ejecutor
        </h1>
        <p class="text-gray-600 mt-2">Total general por ejecutor</p>
    </div>
    
    <!-- Tarjeta Resumen General -->
    <div class="bg-gradient-to-r from-green-500 to-green-600 text-white p-6 rounded-xl shadow-lg mb-8">
        <div class="text-white text-sm font-semibold mb-1">
            <i class="fas fa-money-bill-wave mr-2"></i>Producción Total General
        </div>
        <div class="text-4xl font-bold">S/ {{ total_general|floatformat:2 }}</div>
        <div class="text-sm mt-2">
            {{ total_ejecutores }} ejecutor{{ total_ejecutores|pluralize:"es" }} en total
        </div>
    </div>
    
    <!-- Tabla Simple -->
    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
        <table class="min-w-full divide-y divide-gray-200">
            <thead>
                <tr class="bg-gradient-to-r from-blue-500 to-blue-600">
                    <th class="px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider">
                        <i class="fas fa-user mr-2"></i>Ejecutor
                    </th>
                    <th class="px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider">
                        <i class="fas fa-calculator mr-2"></i>Cantidad Suministros
                    </th>
                    <th class="px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider">
                        <i class="fas fa-coins mr-2"></i>Total (S/)
                    </th>
                    <th class="px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider">
                        <i class="fas fa-chart-bar mr-2"></i>Rango
                    </th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-100">
                {% for ejecutor in ejecutores %}
                <tr class="hover:bg-gray-50">
                    <!-- Columna Ejecutor -->
                    <td class="px-6 py-4">
                        <div class="font-semibold text-gray-900">{{ ejecutor.ejecutor }}</div>
                        {% if ejecutor.nombres_originales|length > 1 %}
                        <div class="text-xs text-gray-500 mt-1">
                            <i class="fas fa-exclamation-triangle text-yellow-500 mr-1"></i>
                            Consolidado de {{ ejecutor.nombres_originales|length }} variaciones
                        </div>
                        {% endif %}
                    </td>
                    
                    <!-- Columna Cantidad -->
                    <td class="px-6 py-4">
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800">
                            {{ ejecutor.cantidad }}
                        </span>
                    </td>
                    
                    <!-- Columna Total -->
                    <td class="px-6 py-4">
                        <span class="text-lg font-bold 
                            {% if ejecutor.total_monto >= 7000 %}text-red-600
                            {% elif ejecutor.total_monto >= 5000 %}text-yellow-600
                            {% else %}text-green-600
                            {% endif %}">
                            S/ {{ ejecutor.total_monto|floatformat:2 }}
                        </span>
                    </td>
                    
                    <!-- Columna Rango -->
                    <td class="px-6 py-4">
                        {% if ejecutor.total_monto >= 7000 %}
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-800">
                            <i class="fas fa-fire mr-1"></i> Alto
                        </span>
                        {% elif ejecutor.total_monto >= 5000 %}
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800">
                            <i class="fas fa-star mr-1"></i> Medio
                        </span>
                        {% else %}
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800">
                            <i class="fas fa-leaf mr-1"></i> Bajo
                        </span>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4" class="px-6 py-8 text-center text-gray-500">
                        <i class="fas fa-inbox text-3xl mb-3 text-gray-300"></i>
                        <p class="text-lg">No hay datos de ejecutores disponibles</p>
                        <p class="text-sm mt-1">No se encontraron suministros con ejecutor asignado.</p>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
            
            <!-- Footer con totales -->
            <tfoot class="bg-gray-50">
                <tr>
                    <td class="px-6 py-4 font-bold text-gray-700">TOTALES</td>
                    <td class="px-6 py-4">
                        <span class="font-bold text-gray-700">
                            {{ ejecutores|length }} ejecutor{{ ejecutores|length|pluralize:"es" }}
                        </span>
                    </td>
                    <td class="px-6 py-4">
                        <span class="text-xl font-bold text-green-600">
                            S/ {{ total_general|floatformat:2 }}
                        </span>
                    </td>
                    <td class="px-6 py-4">
                        <span class="text-sm text-gray-600">
                            {{ total_ejecutores }} registro{{ total_ejecutores|pluralize:"s" }}
                        </span>
                    </td>
                </tr>
            </tfoot>
        </table>
    </div>
    
    <!-- Información adicional (SIN FILTRO PERSONALIZADO) -->
    <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="bg-gray-50 p-4 rounded-lg">
            <h3 class="font-semibold text-gray-700 mb-2">
                <i class="fas fa-info-circle text-blue-500 mr-2"></i>Notas
            </h3>
            <ul class="text-sm text-gray-600 space-y-1">
                <li>• Los nombres han sido normalizados</li>
                <li>• Nombres similares se han consolidado</li>
                <li>• Solo ejecutores con suministros asignados</li>
            </ul>
        </div>
        
        <div class="bg-gray-50 p-4 rounded-lg">
            <h3 class="font-semibold text-gray-700 mb-2">
                <i class="fas fa-palette text-purple-500 mr-2"></i>Leyenda
            </h3>
            <ul class="text-sm text-gray-600 space-y-1">
                <li><span class="text-green-600 font-semibold">Verde</span>: &lt; S/ 5,000</li>
                <li><span class="text-yellow-600 font-semibold">Amarillo</span>: S/ 5,000-7,000</li>
                <li><span class="text-red-600 font-semibold">Rojo</span>: &gt; S/ 7,000</li>
            </ul>
        </div>
        
        <div class="bg-gray-50 p-4 rounded-lg">
            <h3 class="font-semibold text-gray-700 mb-2">
                <i class="fas fa-database text-green-500 mr-2"></i>Estadísticas
            </h3>
            <ul class="text-sm text-gray-600 space-y-1">
                <li>• Total ejecutores: {{ total_ejecutores }}</li>
                <li>• Producción total: S/ {{ total_general|floatformat:2 }}</li>
                <!-- SIN LÍNEA DE PROMEDIO -->
            </ul>
        </div>
    </div>
</div>
{% endblock %}